{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["/**\n * @export\n * @class AddressAutocomplete\n * @author Deric Cain <deric.cain@gmail.com>\n */\nexport default class AddressAutocomplete {\n  /**\n   * Creates an instance of AddressAutocomplete.\n   * @param {string} element - This should be in the form of either '.address' or '#address'\n   * @param {function} callback - This callback will have the result passed as the first param\n   * @throws Error - If we don't have a valid element\n   * @memberof AddressAutocomplete\n   */\n  constructor(element, callback) {\n    // Can take element as '.class-name' or '#id-name'\n    this.element = document.querySelector(element);\n\n    // If we do not find the element, then we need to throw an error\n    if (!this.element) {\n      throw new Error(\n        \"The element you specified is not a valid element. You should attach an input using a class '.some-class' or an ID '#some-id'.\"\n      );\n    }\n\n    this.callback = callback;\n\n    // We are binding the context of 'this' to this class instance\n    this.extractAddress = this.extractAddress.bind(this);\n    this.getUsersLocation = this.getUsersLocation.bind(this);\n    this.handle();\n  }\n\n  /**\n   * This takes care of make everything happen\n   *\n   * @memberof AddressAutocomplete\n   */\n  handle() {\n    // When the document is ready, we need to fire everything off.\n    document.addEventListener('readystatechange', () => {\n      this.initializeAutocomplete();\n      this.element.addEventListener('focus', this.getUsersLocation);\n    });\n  }\n\n  /**\n   * This method takes care of getting the autocomplete up and running\n   *\n   * @memberof AddressAutocomplete\n   */\n  initializeAutocomplete() {\n    this.autocomplete = new google.maps.places.Autocomplete(this.element, {\n      types: ['geocode'],\n    });\n    this.autocomplete.addListener('place_changed', this.extractAddress);\n  }\n\n  /**\n   * Here, we are taking care of getting the address from the results.\n   *\n   * @memberof AddressAutocomplete\n   */\n  extractAddress() {\n    const componentForm = {\n      street_number: 'short_name',\n      route: 'long_name',\n      locality: 'long_name',\n      administrative_area_level_1: 'short_name',\n      country: 'long_name',\n      postal_code: 'short_name',\n    };\n\n    const resultRaw = this.autocomplete.getPlace();\n    const {\n      address_components,\n      formatted_address,\n      geometry: {\n        location: {\n          lat,\n          lng\n        }\n      }\n    } = resultRaw;\n    const addressObject = {\n      streetNumber: '',\n      streetName: '',\n      cityName: '',\n      stateAbbr: '',\n      zipCode: '',\n    };\n    const geoObject = resultRaw.geomatry.location;\n\n    // Need to loop over the results and create a friendly object\n    for (let i = 0; i < address_components.length; i++) {\n      const addressType = address_components[i].types[0];\n      if (componentForm[addressType]) {\n        switch (addressType) {\n          case 'street_number':\n            addressObject.streetNumber = address_components[i].long_name;\n            break;\n          case 'route':\n            addressObject.streetName = address_components[i].long_name;\n            break;\n          case 'locality':\n            addressObject.cityName = address_components[i].long_name;\n            break;\n          case 'administrative_area_level_1':\n            addressObject.stateAbbr = address_components[i].short_name;\n            addressObject.state = address_components[i].long_name;\n            break;\n          case 'postal_code':\n            addressObject.zipCode = address_components[i].long_name;\n            break;\n          case 'country':\n            addressObject.countryAbbr = address_components[i].short_name;\n            addressObject.country = address_components[i].long_name;\n            break;\n          default:\n            break;\n        }\n      }\n    }\n\n    const resultFormatted = Object.assign({}, addressObject, {\n      formattedAddress: formatted_address,\n      formattedGeometry: geoObject\n    });\n\n    // This is where we check for the callback and then call it, passing our resutls\n    this.callback(resultFormatted, resultRaw);\n  }\n\n  /**\n   * This will help us narrow down the results of the autocomplete to a user's location\n   *\n   * @memberof AddressAutocomplete\n   */\n  getUsersLocation() {\n    // Using feature detection to make sure the browser supports geolocation\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(position => {\n        const geolocation = {\n          lat: position.coords.latitude,\n          lng: position.coords.longitude,\n        };\n        const circle = new google.maps.Circle({\n          center: geolocation,\n          radius: position.coords.accuracy,\n        });\n        this.autocomplete.setBounds(circle.getBounds());\n      });\n    }\n  }\n}\n"],"names":["AddressAutocomplete","element","callback","document","querySelector","this","Error","extractAddress","bind","getUsersLocation","handle","addEventListener","initializeAutocomplete","_this","autocomplete","google","maps","places","Autocomplete","addListener","componentForm","resultRaw","getPlace","address_components","formatted_address","addressObject","geoObject","geomatry","location","i","length","addressType","types","streetNumber","long_name","streetName","cityName","stateAbbr","short_name","state","zipCode","countryAbbr","country","resultFormatted","Object","assign","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","circle","Circle","accuracy","setBounds","getBounds"],"mappings":"6XAKqBA,0CAQPC,EAASC,mCAEdD,QAAUE,SAASC,cAAcH,IAGjCI,KAAKJ,cACF,IAAIK,MACR,sIAICJ,SAAWA,OAGXK,eAAiBF,KAAKE,eAAeC,KAAKH,WAC1CI,iBAAmBJ,KAAKI,iBAAiBD,KAAKH,WAC9CK,mFAUIC,iBAAiB,mBAAoB,aACvCC,2BACAX,QAAQU,iBAAiB,QAASE,EAAKJ,0EAUzCK,aAAe,IAAIC,OAAOC,KAAKC,OAAOC,aAAab,KAAKJ,gBACnD,kBAELa,aAAaK,YAAY,gBAAiBd,KAAKE,6DAuC/C,IA9BCa,iBACW,mBACR,qBACG,wCACmB,qBACpB,wBACI,cAGTC,EAAYhB,KAAKS,aAAaQ,WAElCC,EAQEF,EARFE,mBACAC,EAOEH,EAPFG,kBAQIC,gBACU,cACF,YACF,aACC,WACF,IAELC,EAAYL,EAAUM,SAASC,SAG5BC,EAAI,EAAGA,EAAIN,EAAmBO,OAAQD,IAAK,KAC5CE,EAAcR,EAAmBM,GAAGG,MAAM,MAC5CZ,EAAcW,UACRA,OACD,kBACWE,aAAeV,EAAmBM,GAAGK,oBAEhD,UACWC,WAAaZ,EAAmBM,GAAGK,oBAE9C,aACWE,SAAWb,EAAmBM,GAAGK,oBAE5C,gCACWG,UAAYd,EAAmBM,GAAGS,aAClCC,MAAQhB,EAAmBM,GAAGK,oBAEzC,gBACWM,QAAUjB,EAAmBM,GAAGK,oBAE3C,YACWO,YAAclB,EAAmBM,GAAGS,aACpCI,QAAUnB,EAAmBM,GAAGK,eAQhDS,EAAkBC,OAAOC,UAAWpB,oBACtBD,oBACCE,SAIhBxB,SAASyC,EAAiBtB,yDAU3ByB,UAAUC,uBACFA,YAAYC,mBAAmB,gBACjCD,OACCE,EAASC,OAAOC,aAChBF,EAASC,OAAOE,WAEjBC,EAAS,IAAItC,OAAOC,KAAKsC,eACrBP,SACAE,EAASC,OAAOK,aAErBzC,aAAa0C,UAAUH,EAAOI"}